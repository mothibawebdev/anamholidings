<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Anam Holdings: Cleaning Services | Booking & Invoice</title>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <style>
    body {
  font-family: Arial, sans-serif;
  background-color: #fafafa;
  margin: 0;
  padding: 10px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

header {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
  text-align: center;
  gap: 10px;
  margin-bottom: 10px;
}

header img {
  height: 150px;
  max-width: 100%;
  transition: all 0.3s ease;
}

header h1 {
  color: #601c14;
  margin: 0;
  font-size: 1.8em;
  font-weight: bold;
}

/* Mobile view: stack logo and title */
@media (max-width: 900px) {
  header {
    flex-direction: column;
  }

  header img {
    height: 100px;
  }

  header h1 {
    font-size: 1.3em;
    margin-top: 5px;
  }
}


h1 {
  color: #601c14;
  margin: 0;
}

.container {
  display: flex;
  gap: 20px;
  width: 100%;
  max-width: 1500px;
}

.form-section,
.invoice-section {
  background: white;
  border-radius: 10px;
  padding: 20px 30px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  flex: 1;
}

.form-group {
  margin-bottom: 10px;
}

.form-row {
  display: flex;
  gap: 30px;
  flex-wrap: wrap;
}

.form-row .form-group.half {
  flex: 1 1 45%;
  min-width: 200px;
}

label {
  display: block;
  font-weight: bold;
  margin-bottom: 5px;
}

input,
select,
textarea {
  width: 100%;
  padding: 10px;
  border-radius: 5px;
  border: 1px solid #ccc;
  box-sizing: border-box;
  font-size: 16px;
}

textarea {
  resize: none;
}

.note-box {
  background: #fff4cc;
  border-left: 6px solid #f1b800;
  padding: 10px;
  margin-bottom: 15px;
  font-size: 0.9em;
}

.invoice {
  white-space: pre-wrap;
  background: #f9f9f9;
  padding: 15px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-family: monospace;
  overflow-x: auto;
}

button {
  background-color: #601c14;
  color: white;
  border: none;
  padding: 12px 18px;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
  margin-top: 10px;
  width: 100%;
  max-width: 250px;
}

button:hover {
  background-color: #8b2e22;
}

.select2-container--default .select2-selection--multiple {
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px;
  min-height: 42px;
  font-size: 16px;
}

/* Responsive layout: stack form and invoice vertically on small screens */
@media (max-width: 900px) {
  .container {
    flex-direction: column;
  }

  .form-section,
  .invoice-section {
    width: 100%;
    padding: 15px 20px;
  }

  .invoice-section {
    margin-top: 20px;
  }

  input,
  select,
  textarea {
    font-size: 15px;
  }

  button {
    font-size: 15px;
    padding: 10px;
  }

  .note-box {
    font-size: 0.85em;
  }
}
input:disabled,
select:disabled {
  background-color: #f5f5f5;
  cursor: not-allowed;
  opacity: 0.8;
}

  </style>
</head>
<body>

  <header>
  <img src="logo.png" alt="Anam Cleaning Services Logo">
  <!-- <h1>Anam Cleaning Services</h1> -->
</header>

  <div class="container">
    <!-- Form Section -->
    <div class="form-section">
      <div class="note-box">
        <strong>Please note:</strong> This is a preliminary invoice. The final invoice will be confirmed onsite.<br><br>
        <strong>Note:</strong> Our cleaning services are available exclusively on weekends.
      </div>


      <div class="form-row">
  <div class="form-group half">
    <label>First Name</label>
    <input type="text" id="fname" required onchange="updateInvoice()">
  </div>
  <div class="form-group half">
    <label>Last Name</label>
    <input type="text" id="lname" required onchange="updateInvoice()">
  </div>
</div>
    <div class="form-row">
      <div class="form-group half">
        <label>Contact Number</label>
        <input type="text" id="contact" required onchange="updateInvoice()">
      </div>
      <div class="form-group half">
        <label>Email (Optional)</label>
        <input type="email" id="email" onchange="updateInvoice()">
      </div>
    </div>
      
      <div class="form-group">
        <label>Residential Address</label>
        <input type="text" id="address" required name="Residential Address" onchange="updateInvoice()">
      </div>

      <div class="form-group">
        <label>Service Required</label>
        <select id="service" required onchange="updateInvoice()">
          <option value="">Select</option>
          <option value="Standard Cleaning">Standard Cleaning</option>
          <option value="Deep Cleaning">Deep/Spring Cleaning</option>
          <option value="Move In/Out Cleaning">Move In/Out Cleaning</option>
          <option value="Event Cleaning">Event Cleaning</option>
        </select>
      </div>

      <div class="form-row">        
        <div class="form-group half">
          <label>Bedrooms</label>
          <input type="number" id="bedrooms" min="0" value="0" required onchange="updateInvoice()">
        </div>
        <div class="form-group half">
          <label>Bathrooms</label>
          <input type="number" id="bathrooms" min="0" value="0" onchange="updateInvoice()">
        </div>
      </div>

      <div class="form-group">
        <label>Bathroom Type</label>
        <select id="bathroomType" required onchange="updateInvoice()">
          <option value="">Select</option>
          <option value="Bathtub">Bathtub</option>
          <option value="Shower">Shower</option>
          <option value="Both">Both</option>
        </select>
      </div>
      <div class="form-group">
        <label for="addional_service">Optional Services (Inclusive with Deep & Move-in/out Cleaning)</label>
        <select id="extras" multiple="multiple" style="width:100%;" onchange="updateInvoice()">
        <option value="Oven">Oven</option>
        <option value="Ironing">Ironing</option>
        <option value="Carpet">Carpet</option>
        <option value="Windows">Windows</option>
        <option value="Laundry">Laundry</option>
        <option value="Fridge">Fridge</option>
        <option value="Cabinet">Cabinet</option>
        <option value="Moult_Removal">Moult Removal</option>
        <option value="Dishes">Dishes</option>
      </select>
      </div>
          
      <div class="form-row">
        <div class="form-group half">
          <label>Date</label>
          <input type="date" id="date" required onchange="updateInvoice()" readonly style="padding:8px; width:220px;" placeholder="Select weekend only">
        </div>
        <div class="form-group half">
          <label>Time</label>
          <input type="time" id="time" required onchange="updateInvoice()">
        </div>
          
        </div>
    </div>

    <!-- Invoice Section -->
    
    <div class="invoice-section">      
      <h2>Invoice Preview</h2>
      <div id="invoiceOutput" class="invoice"></div>
      <br/>
      <div class="note-box">
        Download and send it to us by WhatsApp or email. WhatsApp: 071 150 5808. Email: lungelwasgelem@gmail.com
      </div>
      <button onclick="downloadPDF()">Download Invoice</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    function updateInvoice() {
      const fname = document.getElementById('fname').value || '';
      const lname = document.getElementById('lname').value || '';
      const contact = document.getElementById('contact').value || '';
      const email = document.getElementById('email').value || '';
      const address = document.getElementById('address').value || '';
      const service = document.getElementById('service').value || '';
      const bedroomsInput = document.getElementById('bedrooms');
      const bathroomsInput = document.getElementById('bathrooms');
      const bathroomTypeSelect = document.getElementById('bathroomType');
      const date = document.getElementById('date').value;
      const time = document.getElementById('time').value;
      const extrasSelect = document.getElementById('extras');

      const selectedExtras = Array.from(extrasSelect.selectedOptions).map(opt => opt.value);
      const bathrooms = parseInt(bathroomsInput.value) || 0;
      const bedrooms = parseInt(bedroomsInput.value) || 0;

      // --- Disable rules based on selected service ---

      if(service === "Event Cleaning"){
          extrasSelect.disabled = true;
          //$('#extras').val('').trigger('change');
          bathroomsInput.value = 0;
          bedroomsInput.value=0;

          bathroomTypeSelect.disabled = true;          

          bathroomsInput.disabled = true;
          bedroomsInput.disabled = true;
          
      }
      else if(service === "Deep Cleaning" ||  service === "Move In/Out Cleaning") {
        extrasSelect.disabled = true;

        bathroomTypeSelect.disabled = false;
        bathroomsInput.disabled = false;
        bedroomsInput.disabled = false;
      }
      else{
          bathroomTypeSelect.disabled = false;
          extrasSelect.disabled = false;
          bathroomsInput.disabled = false;
          bedroomsInput.disabled = false;
      }

      const prices = {
        standardCleaning: 450,
        deepCleaning: 1200,
        perBedroom: 100,
        perBedroomDeep: 180,
        bathroomStandard: 80,
        bathroomDeep: 250,
        extras: {
          windows: 140,
          ironing: 35,
          laundry: 100,
          carpet: 60,
          fridge: 90,
          oven: 30,
          cabinet: 200,
          moult_removal: 300,
          dishes: 100
        }
      };

      let subtotal = 0;

      if (service === "Standard Cleaning") subtotal += prices.standardCleaning;
      else if (service === "Deep Cleaning") subtotal += prices.deepCleaning;
      else if (service === "Move In/Out Cleaning") subtotal += prices.deepCleaning + 200; // small uplift
      else if (service === "Event Cleaning") {subtotal += 1500;}
      {}

      subtotal += bedrooms * (service === "Deep Cleaning" ? prices.perBedroomDeep : prices.perBedroom);

      subtotal += bathrooms * (service === "Deep Cleaning" ? prices.bathroomDeep : prices.bathroomStandard);

      let extrasText = [];
        selectedExtras.forEach(extra => {
          const key = extra.toLowerCase(); // normalize to lowercase
          const price = prices.extras[key] || 0;
          extrasText.push(`${extra} (R${price})`);
          subtotal += price;
      });

      const vat = subtotal * 0.15;
      const total = subtotal + vat;

      const invoiceText = `
Bill To:
--------------------------------------
${fname} ${lname}
Contact Number: ${contact}
Email: ${email}
Residential Address: ${address}

--------------------------------------
Service Type: ${service || "Not Selected"}
Bedrooms: ${service === "Event Cleaning" 
  ? "Not applicable" 
  : `${bedrooms} @ R${service === "Deep Cleaning" ? prices.perBedroomDeep : prices.perBedroom}` }
Bathrooms: ${service === "Event Cleaning" 
  ? "Not applicable" 
  : `${bathrooms} @ R${service === "Deep Cleaning" ? prices.bathroomDeep : prices.bathroomStandard}` }
Extras: ${service === "Event Cleaning" 
  ? "Not applicable" 
  : extrasText.length 
    ? extrasText.join(", ") 
    : "None"}
--------------------------------------

Subtotal: R${subtotal.toFixed(2)}
VAT (15%): R${vat.toFixed(2)}

Estimated Total (Incl. VAT): R${total.toFixed(2)}
--------------------------------------
Date: ${date}
Time: ${time}
`;

      document.getElementById('invoiceOutput').textContent = invoiceText;
    }
    updateInvoice();

    async function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: "mm", format: "a4" });
  const pageWidth = doc.internal.pageSize.getWidth();
  const currentDate = new Date().toISOString().split("T")[0]; // yyyy-mm-dd

  // --- Load and add logo (centered)
  const img = new Image();
  img.src = "logo.png";

  img.onload = function () {
    const logoWidth = 50;
    const logoHeight = 20;
    const logoX = (pageWidth - logoWidth) / 2;
    doc.addImage(img, "PNG", logoX, 10, logoWidth, logoHeight);

    // --- Header text ---
    doc.setFont("helvetica", "bold");
    doc.setFontSize(14);
    doc.text("Cleaning Services", pageWidth / 2, 38, { align: "center" });

    doc.setFont("helvetica", "normal");
    doc.setFontSize(10);
    doc.text("Professional Residential & Deep Cleaning Services", pageWidth / 2, 44, { align: "center" });
    doc.text("Email: lungelwasgelem@gmail.com | Phone: +27 71 150 5808", pageWidth / 2, 49, { align: "center" });

    // --- Separator line ---
    doc.setDrawColor(96, 28, 20);
    doc.line(10, 52, 200, 52);

    // --- Invoice Header ---
    const fname = document.getElementById("fname").value || "";
    const lname = document.getElementById("lname").value || "";
    const contact = document.getElementById("contact").value || "";
    const email = document.getElementById("email").value || "";
    const address = document.getElementById("address").value || "";
    const service = document.getElementById("service").value || "";
    const bedrooms = parseInt(document.getElementById("bedrooms").value) || 0;
    const bathrooms = parseInt(document.getElementById("bathrooms").value) || 0;
    const bathroomType = document.getElementById("bathroomType").value;
    const date = document.getElementById("date").value;
    const time = document.getElementById("time").value;
    const extrasSelect = document.getElementById("extras");
    const selectedExtras = Array.from(extrasSelect.selectedOptions).map(opt => opt.value);

    const prices = {
      standardCleaning: 450,
      deepCleaning: 1200,
      moveInOut: 1400,
      eventCleaning: 1500,
      perBedroom: 100,
      bathroomStandard: 80,
      bathroomDeep: 250,
      extras: {
        windows: 140,
        ironing: 35,
        laundry: 100,
        carpet: 60,
        fridge: 90,
        oven: 30,
        cabinet: 60,
        moult_removal: 300,
        dishes: 100
      }
    };

    let subtotal = 0;

    // --- Service cost ---
    if (service === "Standard Cleaning") subtotal += prices.standardCleaning;
    else if (service === "Deep Cleaning") subtotal += prices.deepCleaning;
    else if (service === "Move In/Out Cleaning") subtotal += prices.moveInOut;
    else if (service === "Event Cleaning") subtotal += prices.eventCleaning;

    subtotal += bedrooms * prices.perBedroom;

    if (service === "Deep Cleaning")
      subtotal += bathrooms * prices.bathroomDeep;
    else
      subtotal += bathrooms * prices.bathroomStandard;

    const extrasText = [];
    selectedExtras.forEach(extra => {
      const key = extra.toLowerCase();
      const price = prices.extras[key] || 0;
      extrasText.push([extra, "1", price.toFixed(2), price.toFixed(2)]);
      subtotal += price;
    });

    const vat = subtotal * 0.15;
    const total = subtotal + vat;

    // --- Header Title ---
    doc.setFontSize(14);
    doc.setFont("helvetica", "bold");
    doc.text("Invoice Summary", 10, 60);
    doc.text(`Invoice Date: ${currentDate}`, pageWidth - 10, 60, { align: "right" });

    // --- Bill To section ---
    doc.setFontSize(10);
    doc.setFont("helvetica", "normal");
    doc.text("Bill To:", 10, 70);
    doc.text(`Full Name:${fname} ${lname}`, 10, 76);
    doc.text(`Contact: ${contact}`, 10, 82);
    doc.text(`Email: ${email}`, 10, 88);
    doc.text(`Address: ${address}`, 10, 94);
    doc.text(`Date: ${date}`,10,100);
    doc.text(`Time: ${time}`, 10,106);

    // --- Prepare items for the table ---
    const items = [];
    if (service) items.push(["Service Type", "1", "-", service]);
    if (bedrooms > 0) items.push(["Bedrooms", bedrooms, prices.perBedroom.toFixed(2), (bedrooms * prices.perBedroom).toFixed(2)]);
    if (bathrooms > 0) {
      const bathRate = service === "Deep Cleaning" ? prices.bathroomDeep : prices.bathroomStandard;
      items.push(["Bathrooms", bathrooms, bathRate.toFixed(2), (bathrooms * bathRate).toFixed(2)]);
    }
    if (extrasText.length > 0) extrasText.forEach(extra => items.push(extra));

    // --- Add Table ---
    doc.autoTable({
      startY: 112,
      head: [["Description", "Qty", "Rate (R)", "Amount (R)"]],
      body: items,
      theme: "grid",
      styles: { halign: "left", fontSize: 10 },
      headStyles: { fillColor: [96, 28, 20], textColor: 255 },
      columnStyles: {
        0: { cellWidth: 80 },
        1: { halign: "center", cellWidth: 20 },
        2: { halign: "right", cellWidth: 25 },
        3: { halign: "right", cellWidth: 30 }
      }
    });

    // --- Totals ---
    let finalY = doc.lastAutoTable.finalY + 10;
    doc.setFont("helvetica", "bold");
    doc.text(`Subtotal: R${subtotal.toFixed(2)}`, 140, finalY);
    doc.text(`VAT (15%): R${vat.toFixed(2)}`, 140, finalY + 6);
    doc.text(`Total (Incl. VAT): R${total.toFixed(2)}`, 140, finalY + 12);

    // --- Terms & Conditions ---
    finalY += 25;
    doc.setFont("helvetica", "bold");
    doc.text("Terms & Conditions", 10, finalY);
    doc.setFont("helvetica", "normal");
    doc.text("50% payment is to be paid 36 hours prior to your booking day.", 10, finalY + 6);
    doc.text("Please make payments to the following:", 10, finalY + 12);
    doc.text("Bank: Capitec Bank", 10, finalY + 18);
    doc.text("Account Name: Lungelwa Mothiba", 10, finalY + 24);
    doc.text("Account Number: 1366465251", 10, finalY + 30);

    // --- Footer ---
    const pageHeight = doc.internal.pageSize.height;
    doc.setFontSize(9);
    doc.setTextColor(100);
    doc.text([
      "Kindly send this invoice by WhatsApp to 071 150 5808.",
      "",
      "Thank you for choosing our services!"
    ], 10, pageHeight - 15);

    // --- Save PDF ---
    doc.save("AnamCleaningInvoice.pdf");

    // --- Send to WhatsApp ---
    // const phoneNumber = "27711505808"; // no "+" sign
    // const message = encodeURIComponent(
    //   "Hello Lungi,\nI have generated my cleaning invoice. Please find it attached."
    // );
    // const whatsappURL = `https://wa.me/${phoneNumber}?text=${message}`;
    // window.open(whatsappURL, "_blank");
  };
}
  
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script>
      $(document).ready(function() {
          $('#extras').select2({
          placeholder: "Select extras",
          allowClear: true,
          width: '100%',
          dropdownAutoWidth: true
      }).on('change', function() {
          updateInvoice();
      });
    });
  </script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
    // Disable Monday (1) through Friday (5). 0 = Sunday, 6 = Saturday.
    flatpickr("#date", {
      dateFormat: "Y-m-d",
      // disable function returns true for dates to disable
      disable: [
        function(date) {
          const day = date.getDay();
          return day >= 1 && day <= 5; // disable Mon..Fri
        }
      ],
      // optional: show which days are disabled on hover
      onReady: function(selectedDates, dateStr, instance) {
        instance.calendarContainer.classList.add('fp-weekdays-disabled');
      }
    });
  </script>
</body>
</html>
